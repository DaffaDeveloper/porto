<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ravage - Music</title>
  <link rel="icon" type="image/png" href="https://files.catbox.moe/hgxu77.jpg">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="style.css">
<style>
:root{
  --bg:#0a0f1a; --card:#101a33; --muted:#9aa4c7; --text:#eaf0ff;
  --primary:#9b5cff; --secondary:#00d4ff; --danger:#ff5a6b;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:linear-gradient(180deg,#0a0f1a,#0b1120);color:var(--text);font-family:Poppins,system-ui;overflow-x:hidden}
/* ==== Loading Screen ==== */
#loadingScreen{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:9999;color:#fff;font-family:Orbitron;
}
.loader{
  border:6px solid rgba(255,255,255,.2);border-top:6px solid #fff;
  border-radius:50%;width:60px;height:60px;animation:spin 1s linear infinite;
}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
#loadingText{margin-top:14px;font-size:18px;animation:blink 1.2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}
/* ==== Topbar ==== */
.topbar{display:flex;align-items:center;justify-content:space-between;
  padding:14px 18px;background:rgba(16,22,40,.7);backdrop-filter:blur(8px);position:sticky;top:0;z-index:20}
.brand{display:flex;align-items:center;gap:8px}
.brand .logo{width:34px;height:34px;border-radius:12px;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  display:flex;align-items:center;justify-content:center;color:#fff;font-size:16px}
.brand h1{font-family:Orbitron;font-size:20px}
.searchbar{flex:1;display:flex;gap:8px;margin:0 16px}
.searchbar input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(7,10,20,.5);color:var(--text)}
.searchbar button{background:linear-gradient(90deg,var(--primary),var(--secondary));border:none;padding:0 14px;border-radius:10px;color:#fff;cursor:pointer}
.nav-icons{display:flex;align-items:center;gap:10px}
.navbtn{background:none;border:none;color:#fff;font-size:18px;cursor:pointer;transition:.3s}
.navbtn:hover{color:var(--secondary);text-shadow:0 0 8px var(--secondary)}
.container{max-width:1200px;margin:0 auto;padding:18px}
.section{margin:18px 0}
.section h3{font-family:Orbitron;margin-bottom:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px}
.card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:14px;overflow:hidden}
.card img{width:100%;aspect-ratio:1/1;object-fit:cover}
.card-body{padding:10px}
.card-body .name{font-weight:600;margin-bottom:4px;font-size:14px}
.card-body .artist{font-size:12px;color:var(--muted)}
.row{display:flex;gap:6px;margin-top:8px}
.btn{flex:1;text-align:center;padding:6px;border-radius:8px;font-size:13px;cursor:pointer;font-weight:600}
.btn.play{background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff}
.btn.fav{background:transparent;border:1px solid rgba(255,255,255,.2);color:#fff}
.btn.fav.active{color:#ff5a6b;border-color:#ff5a6b}
.btn.remove{background:transparent;border:1px solid var(--danger);color:var(--danger)}
/* ==== Player ==== */
#playerBox{position:fixed;bottom:20px;right:20px;width:280px;background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:10px;box-shadow:0 10px 25px rgba(0,0,0,.5);display:none;z-index:50}
#playerBox img{width:100%;border-radius:10px;aspect-ratio:16/9;object-fit:cover;margin-bottom:6px}
#playerBox .title{font-family:Orbitron;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
#playerBox .artist{font-size:11px;color:var(--muted);margin-bottom:4px}
.controls{display:flex;justify-content:center;gap:16px;margin:6px 0}
.controls i{font-size:18px;cursor:pointer}
.progress{width:100%}
#closePlayer{position:absolute;top:6px;right:8px;color:var(--muted);cursor:pointer}
.timebar{display:flex;justify-content:space-between;font-size:11px;color:var(--muted)}
/* ==== Review ==== */
.review-actions{display:flex;gap:10px;margin-bottom:12px}
.act-btn{flex:1;padding:10px;border-radius:10px;border:none;cursor:pointer;
  background:linear-gradient(90deg,var(--primary),var(--secondary));color:#fff;font-weight:600}
.review-box input,.review-box textarea{width:100%;margin:6px 0;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:rgba(7,10,20,.5);color:#fff}
.stars{display:flex;gap:6px;margin:6px 0;font-size:20px;cursor:pointer;color:#ccc}
.stars .fa-solid{color:gold}
.desc{font-size:12px;color:var(--muted);margin-bottom:6px}
.review-item{background:rgba(255,255,255,.05);padding:8px;border-radius:8px;margin-bottom:8px}
.review-item .name{font-weight:600}
.review-item .stars{color:gold;font-size:13px;margin-top:4px}
#btnReview{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  font-weight:600;
  font-size:14px;
  cursor:pointer;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
  box-shadow:0 0 10px rgba(155,92,255,.5),0 0 20px rgba(0,212,255,.3);
  transition:.3s;
}
#btnReview:hover{
  transform:translateY(-2px);
  box-shadow:0 0 12px rgba(155,92,255,.8),0 0 25px rgba(0,212,255,.6);
}
.review-item{
  background:rgba(255,255,255,.05);
  padding:10px;
  border-radius:12px;
  margin-bottom:12px;
  border:1px solid rgba(255,255,255,.1);
  display:flex;
  flex-direction:column;
  gap:8px;
}
.review-item .field{
  background:rgba(255,255,255,.08);
  padding:8px 10px;
  border-radius:8px;
  font-size:14px;
  display:flex;
  align-items:center;
  gap:6px;
}
.review-item .field i{
  color:var(--secondary);
}
.review-item .field strong{
  color:var(--primary);
}
/* ==== Footer ==== */
footer{
  text-align:center;padding:14px;margin-top:20px;
  border-top:1px solid rgba(255,255,255,.1);color:var(--muted);font-size:13px
}
footer a{color:var(--secondary);text-decoration:none;font-weight:600}
footer a:hover{text-decoration:underline}
</style>
</head>
<body>
<!-- Loading Screen -->
<div id="loadingScreen">
  <div class="loader"></div>
  <div id="loadingText">Sedang Memuat...</div>
</div>

<header class="topbar">
  <div class="brand"><div class="logo"><i class="fa-solid fa-music"></i></div><h1>MUSIC</h1></div>
  <div class="searchbar"><input id="q" placeholder="Cari lagu..."><button id="btnSearch"><i class="fa-solid fa-search"></i></button></div>
  <div class="nav-icons"><button id="btnHome" class="navbtn"><i class="fa-solid fa-home"></i></button><button id="btnFav" class="navbtn"><i class="fa-solid fa-heart"></i></button></div>
</header>

<main class="container">
  <!-- Review Section -->
  <section class="section">
    <h3><i class="fa-solid fa-message"></i> Ulasan</h3>
    <div class="review-actions">
      <button id="btnShowForm" class="act-btn"><i class="fa-solid fa-pen"></i> Berikan Ulasan</button>
      <button id="btnShowList" class="act-btn"><i class="fa-solid fa-comments"></i> Lihat Ulasan</button>
    </div>
    <div id="reviewForm" class="review-box" style="display:none">
      <input id="revName" placeholder="Name">
      <textarea id="revMsg" placeholder="Pesan..."></textarea>
      <div class="stars" id="starRate">
        <i class="fa-regular fa-star" data-val="1"></i>
        <i class="fa-regular fa-star" data-val="2"></i>
        <i class="fa-regular fa-star" data-val="3"></i>
        <i class="fa-regular fa-star" data-val="4"></i>
        <i class="fa-regular fa-star" data-val="5"></i>
      </div>
      <div id="rateDesc" class="desc">Pilih rating</div>
      <button id="btnReview">Kirim Ulasan</button>
    </div>
    <div id="reviewList" style="display:none"><div id="reviews"></div></div>
  </section>

  <section id="homeSection" class="section">
    <h3><i class="fa-solid fa-fire"></i> Trending </h3>
    <div id="gridMusic" class="grid"></div>
  </section>
  <section id="favSection" class="section" style="display:none">
    <h3><i class="fa-solid fa-heart"></i> Favorite Kamu</h3>
    <div id="gridFav" class="grid"></div>
  </section>
</main>

<div id="playerBox">
  <i id="closePlayer" class="fa-solid fa-xmark"></i>
  <img id="pCover" src="">
  <div class="title" id="pTitle">Judul</div>
  <div class="artist" id="pArtist">Artis</div>
  <div class="controls"><i class="fa-solid fa-backward" id="btnPrev"></i><i class="fa-solid fa-play" id="btnPlay"></i><i class="fa-solid fa-forward" id="btnNext"></i></div>
  <input type="range" id="progress" class="progress" value="0" min="0" max="100">
  <div class="timebar"><span id="curTime">0:00</span><span id="durTime">0:00</span></div>
  <audio id="player"></audio>
</div>

<footer>
  Â© 2025 <a href="https://t.me/daffadevv" target="_blank">Daffa Dev</a>
</footer>

<script>
const API_SEARCH='https://restapi-v2.simplebot.my.id/search/youtube?q=';
const API_DOWNLOAD='https://restapi-v2.simplebot.my.id/download/ytmp3?url=';
let state={musicList:[],currentIndex:0,mode:"home"};
const topics=["lagu tiktok viral","dj remix","dj ambon pica pica","8 letters","pop indonesia","musik barat viral","lagu galau"];

/* Review */
function getReview(){return JSON.parse(localStorage.getItem("reviews")||'[]')}
function setReview(arr){localStorage.setItem("reviews",JSON.stringify(arr))}
function renderReview(){
  const box=document.getElementById("reviews");
  box.innerHTML="";
  let arr=getReview();
  if(arr.length==0){
    box.innerHTML="<p>Belum ada ulasan</p>";
    return;
  }
  arr.forEach(r=>{
    const d=document.createElement("div");
    d.className="review-item";
    d.innerHTML=`
      <div class="field"><i class="fa-solid fa-user"></i> <strong>Name:</strong> ${r.name}</div>
      <div class="field"><i class="fa-solid fa-comment"></i> <strong>Pesan:</strong> ${r.msg}</div>
      <div class="field"><i class="fa-solid fa-star"></i> <strong>Rating:</strong> ${"â­".repeat(r.star)}</div>
    `;
    box.appendChild(d);
  });
}
renderReview();
btnShowForm.onclick=()=>{reviewForm.style.display="block";reviewList.style.display="none";}
btnShowList.onclick=()=>{reviewForm.style.display="none";reviewList.style.display="block";renderReview();}
let rating=0;
document.querySelectorAll("#starRate i").forEach(star=>{
  star.onclick=()=>{
    rating=parseInt(star.dataset.val);
    document.querySelectorAll("#starRate i").forEach(s=>{
      s.className=parseInt(s.dataset.val)<=rating?"fa-solid fa-star":"fa-regular fa-star";
    });
    const desc=["Buruk","Kurang","Cukup","Bagus","Sangat Bagus"];
    rateDesc.textContent=desc[rating-1]||"Pilih rating";
  }
});
btnReview.onclick=()=>{
  let name=revName.value.trim(),msg=revMsg.value.trim();
  if(!name||!msg||rating==0)return alert("Lengkapi ulasan & pilih bintang!");
  let arr=getReview();arr.push({name,msg,star:rating});setReview(arr);
  revName.value="";revMsg.value="";rating=0;
  document.querySelectorAll("#starRate i").forEach(s=>s.className="fa-regular fa-star");
  rateDesc.textContent="Pilih rating";
  alert("Ulasan terkirim!");
};

/* Favorite */
function getFav(){return JSON.parse(localStorage.getItem("fav_music")||'[]')}
function setFav(arr){localStorage.setItem("fav_music",JSON.stringify(arr))}
function renderFav(){
  const grid=document.getElementById("gridFav");grid.innerHTML="";
  let fav=getFav();if(fav.length==0){grid.innerHTML="<p>Belum ada favorite</p>";return;}
  fav.forEach((v,i)=>{
    const c=document.createElement("div");c.className="card";
    c.innerHTML=`<img src="${v.imageUrl}"><div class="card-body"><div class="name">${v.title}</div><div class="artist">${v.channel}</div><div class="row"><button class="btn play"><i class="fa-solid fa-play"></i></button><button class="btn remove"><i class="fa-solid fa-trash"></i></button></div></div>`;
    c.querySelector(".play").onclick=()=>{state.musicList=fav;playMusic(i);}
    c.querySelector(".remove").onclick=()=>{let arr=getFav();arr.splice(i,1);setFav(arr);renderFav();};
    grid.appendChild(c);
  });
}

/* Music */
async function searchMusic(q){const r=await fetch(API_SEARCH+encodeURIComponent(q));const js=await r.json();return js.result||[]}
async function playMusic(idx){
  const v=state.musicList[idx];if(!v)return;
  state.currentIndex=idx;player.pause();player.src="";player.load();
  pCover.src=v.imageUrl;pTitle.textContent=v.title;pArtist.textContent=v.channel;
  playerBox.style.display="block";btnPlay.className="fa-solid fa-spinner fa-spin";
  try{const r=await fetch(API_DOWNLOAD+encodeURIComponent(v.link));const js=await r.json();
    if(js.status&&js.result){player.src=js.result;await player.play();btnPlay.className="fa-solid fa-pause";}
    else{btnPlay.className="fa-solid fa-play";alert("Gagal memuat audio.");}
  }catch(e){btnPlay.className="fa-solid fa-play";alert("Error memuat audio.");}
}
function renderMusic(list){
  const grid=document.getElementById("gridMusic");grid.innerHTML="";
  list.forEach((v,i)=>{
    const c=document.createElement("div");c.className="card";
    c.innerHTML=`<img src="${v.imageUrl}"><div class="card-body"><div class="name">${v.title}</div><div class="artist">${v.channel}</div><div class="row"><button class="btn play"><i class="fa-solid fa-play"></i></button><button class="btn fav"><i class="fa-solid fa-heart"></i></button></div></div>`;
    c.querySelector(".play").onclick=()=>playMusic(i);
    c.querySelector(".fav").onclick=()=>{let fav=getFav();if(!fav.find(x=>x.link==v.link)){fav.push(v);setFav(fav);}renderFav();};
    grid.appendChild(c);
  });
}

/* Controls */
btnPlay.onclick=()=>{if(player.paused){player.play();btnPlay.className="fa-solid fa-pause";}else{player.pause();btnPlay.className="fa-solid fa-play";}};
btnPrev.onclick=()=>{if(state.currentIndex>0)playMusic(state.currentIndex-1)};
btnNext.onclick=()=>{if(state.currentIndex<state.musicList.length-1)playMusic(state.currentIndex+1)};
player.ontimeupdate=()=>{progress.value=player.currentTime/player.duration*100||0;curTime.textContent=formatTime(player.currentTime);durTime.textContent=formatTime(player.duration);};
progress.oninput=()=>{player.currentTime=progress.value/100*player.duration};
closePlayer.onclick=()=>{playerBox.style.display="none"}; // musik tetap jalan
player.onended=()=>{if(state.currentIndex<state.musicList.length-1)playMusic(state.currentIndex+1)};
function formatTime(sec){if(!sec)return"0:00";let m=Math.floor(sec/60),s=Math.floor(sec%60);return m+":"+(s<10?"0"+s:s)}

/* Events */
btnSearch.onclick=async ()=>{ 
  const qv=q.value.trim(); 
  if(!qv)return; 
  const res=await searchMusic(qv); 
  state.musicList=res; 
  state.mode="home"; 
  renderMusic(res); 
};

/* Home & Favorite Tab */
btnHome.onclick=()=>{ 
  homeSection.style.display="block"; 
  favSection.style.display="none"; 
};
btnFav.onclick=()=>{ 
  homeSection.style.display="none"; 
  favSection.style.display="block"; 
  renderFav(); 
};

/* Load Beranda Trending */
async function loadTrending(){
  const topic=topics[Math.floor(Math.random()*topics.length)];
  const res=await searchMusic(topic);
  state.musicList=res;state.mode="home";renderMusic(res);
  // hilangkan loading screen setelah data muncul
  document.getElementById("loadingScreen").style.display="none";
}
loadTrending();

/* Auto ganti trending tiap 1 menit */
setInterval(loadTrending,60000);
</script>
</body>
</html>
